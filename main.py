
base_reaction_dmg = {'1': ['4.3', '8.6', '10.3', '20.6', '25.7', '34.3', '51.5'], '2': ['4.6', '9.3', '11.1', '22.2', '27.8', '37.1', '55.6'], '3': ['5.0', '10.0', '11.9', '23.9', '29.9', '39.8', '59.7'], '4': ['5.3', '10.6', '12.8', '25.5', '31.9', '42.5', '63.8'], '5': ['5.7', '11.3', '13.6', '27.2', '34.0', '45.3', '67.9'], '6': ['6.2', '12.3', '14.8', '29.6', '37.0', '49.3', '73.9'], '7': ['6.7', '13.3', '16.0', '32.0', '40.0', '53.3', '79.9'], '8': ['7.2', '14.4', '17.3', '34.6', '43.3', '57.7', '86.6'], '9': ['7.8', '15.7', '18.8', '37.6', '47.1', '62.7', '94.1'], '10': ['8.5', '17.1', '20.5', '41.0', '51.2', '68.3', '102.4'], '11': ['9.3', '18.6', '22.3', '44.6', '55.8', '74.4', '111.6'], '12': ['10.2', '20.3', '24.4', '48.8', '61.0', '81.3', '122.0'], '13': ['11.1', '22.2', '26.7', '53.3', '66.7', '88.9', '133.3'], '14': ['12.1', '24.3', '29.1', '58.3', '72.8', '97.1', '145.7'], '15': ['13.4', '26.9', '32.2', '64.5', '80.6', '107.5', '161.2'], '16': ['14.8', '29.5', '35.4', '70.9', '88.6', '118.2', '177.2'], '17': ['16.1', '32.2', '38.7', '77.3', '96.6', '128.8', '193.3'], '18': ['17.4', '34.9', '41.8', '83.7', '104.6', '139.4', '209.2'], '19': ['18.8', '37.6', '45.1', '90.1', '112.7', '150.2', '225.4'], '20': ['20.1', '40.3', '48.4', '96.7', '120.9', '161.2', '241.8'], '21': ['21.5', '43.1', '51.7', '103.3', '129.2', '172.2', '258.3'], '22': ['22.9', '45.9', '55.0', '110.0', '137.6', '183.4', '275.1'], '23': ['24.3', '48.6', '58.3', '116.7', '145.9', '194.5', '291.7'], '24': ['25.7', '51.4', '61.7', '123.4', '154.2', '205.6', '308.4'], '25': ['27.1', '54.2', '65.0', '130.1', '162.6', '216.8', '325.2'], '26': ['28.3', '56.6', '67.9', '135.8', '169.8', '226.4', '339.6'], '27': ['29.5', '59.1', '70.9', '141.7', '177.2', '236.2', '354.3'], '28': ['30.7', '61.5', '73.8', '147.6', '184.5', '246.0', '368.9'], '29': ['32.4', '64.9', '77.8', '155.7', '194.6', '259.5', '389.2'], '30': ['34.1', '68.1', '81.8', '163.6', '204.4', '272.6', '408.9'], '31': ['35.7', '71.3', '85.6', '171.2', '214.0', '285.3', '428.0'], '32': ['37.3', '74.5', '89.4', '178.8', '223.5', '298.1', '447.1'], '33': ['38.9', '77.7', '93.3', '186.5', '233.1', '310.8', '466.3'], '34': ['40.5', '80.9', '97.1', '194.2', '242.7', '323.7', '485.5'], '35': ['42.3', '84.6', '101.5', '202.9', '253.7', '338.2', '507.3'], '36': ['44.1', '88.3', '105.9', '211.8', '264.8', '353.0', '529.6'], '37': ['46.0', '92.0', '110.4', '220.9', '276.1', '368.1', '552.2'], '38': ['47.9', '95.9', '115.0', '230.1', '287.6', '383.4', '575.1'], '39': ['49.9', '99.8', '119.7', '239.5', '299.3', '399.1', '598.7'], '40': ['51.8', '103.7', '124.4', '248.9', '311.1', '414.8', '622.1'], '41': ['53.8', '107.7', '129.2', '258.5', '323.1', '430.8', '646.2'], '42': ['56.0', '112.1', '134.5', '269.0', '336.2', '448.3', '672.5'], '43': ['58.4', '116.8', '140.1', '280.2', '350.3', '467.0', '700.5'], '44': ['60.8', '121.7', '146.0', '292.0', '365.0', '486.7', '730.1'], '45': ['64.0', '128.0', '153.6', '307.3', '384.1', '512.1', '768.2'], '46': ['67.1', '134.3', '161.1', '322.3', '402.8', '537.1', '805.6'], '47': ['70.4', '140.8', '168.9', '337.8', '422.3', '563.1', '844.6'], '48': ['73.8', '147.5', '177.0', '354.0', '442.5', '590.0', '885.0'], '49': ['77.3', '154.5', '185.4', '370.9', '463.6', '618.1', '927.2'], '50': ['80.9', '161.8', '194.2', '388.3', '485.4', '647.2', '970.8'], '51': ['84.2', '168.4', '202.1', '404.1', '505.1', '673.5', '1010.3'], '52': ['87.6', '175.3', '210.3', '420.6', '525.8', '701.1', '1051.6'], '53': ['91.1', '182.2', '218.7', '437.4', '546.7', '729.0', '1093.4'], '54': ['94.7', '189.3', '227.2', '454.3', '567.9', '757.2', '1135.9'], '55': ['99.7', '199.3', '239.2', '478.3', '597.9', '797.2', '1195.8'], '56': ['104.1', '208.2', '249.8', '499.7', '624.6', '832.8', '1249.2'], '57': ['108.6', '217.2', '260.6', '521.3', '651.6', '868.8', '1303.2'], '58': ['113.2', '226.5', '271.8', '543.5', '679.4', '905.9', '1358.9'], '59': ['118.2', '236.3', '283.6', '567.1', '708.9', '945.2', '1417.8'], '60': ['123.2', '246.4', '295.7', '591.5', '739.3', '985.8', '1478.7'], '61': ['128.4', '256.8', '308.1', '616.3', '770.4', '1027.1', '1540.7'], '62': ['134.8', '269.6', '323.5', '646.9', '808.7', '1078.2', '1617.3'], '63': ['141.4', '282.8', '339.3', '678.6', '848.3', '1131.0', '1696.5'], '64': ['148.1', '296.3', '355.5', '711.0', '888.8', '1185.1', '1777.6'], '65': ['156.1', '312.2', '374.7', '749.3', '936.7', '1248.9', '1873.3'], '66': ['162.9', '325.7', '390.9', '781.8', '977.2', '1302.9', '1954.4'], '67': ['169.9', '339.7', '407.7', '815.4', '1019.2', '1359.0', '2038.5'], '68': ['176.9', '353.9', '424.7', '849.4', '1061.7', '1415.6', '2123.4'], '69': ['184.2', '368.3', '442.0', '884.0', '1105.0', '1473.3', '2210.0'], '70': ['191.4', '382.8', '459.4', '918.8', '1148.5', '1531.3', '2296.9'], '71': ['198.7', '397.4', '476.9', '953.7', '1192.2', '1589.5', '2384.3'], '72': ['206.2', '412.3', '494.8', '989.6', '1237.0', '1649.4', '2474.0'], '73': ['212.8', '425.6', '510.7', '1021.4', '1276.7', '1702.3', '2553.5'], '74': ['219.4', '438.9', '526.6', '1053.3', '1316.6', '1755.5', '2633.2'], '75': ['228.6', '457.1', '548.5', '1097.1', '1371.3', '1828.5', '2742.7'], '76': ['236.7', '473.4', '568.0', '1136.1', '1420.1', '1893.5', '2840.2'], '77': ['244.9', '489.7', '587.6', '1175.3', '1469.1', '1958.8', '2938.2'], '78': ['252.8', '505.6', '606.7', '1213.5', '1516.8', '2022.4', '3033.7'], '79': ['261.2', '522.4', '626.9', '1253.8', '1567.2', '2089.6', '3134.4'], '80': ['269.4', '538.7', '646.5', '1292.9', '1616.2', '2154.9', '3232.3'], '81': ['277.5', '555.0', '666.0', '1332.0', '1665.0', '2220.0', '3330.0'], '82': ['285.7', '571.5', '685.8', '1371.6', '1714.5', '2286.0', '3428.9'], '83': ['294.1', '588.2', '705.8', '1411.6', '1764.6', '2352.7', '3529.1'], '84': ['302.5', '605.1', '726.1', '1452.2', '1815.3', '2420.4', '3630.6'], '85': ['313.5', '626.9', '752.3', '1504.6', '1880.8', '2507.7', '3761.5'], '86': ['322.2', '644.5', '773.4', '1546.7', '1933.4', '2577.9', '3866.9'], '87': ['331.4', '662.7', '795.3', '1590.6', '1988.2', '2651.0', '3976.5'], '88': ['340.9', '681.7', '818.1', '1636.1', '2045.2', '2726.9', '4090.4'], '89': ['351.3', '702.5', '843.1', '1686.1', '2107.6', '2810.2', '4215.3'], '90': ['361.7', '723.4', '868.1', '1736.2', '2170.3', '2893.7', '4340.6']}
# Burning Superconduct Swirl Electro-Charge/Shattered Overloaded/Bloom Burgeon/Hyperbloom
#    0         1         2                3                   4                 5

character_level_multiplier = {'1': '17.165605', '2': '18.535048', '3': '19.904854', '4': '21.274903', '5': '22.6454', '6': '24.649613', '7': '26.640643', '8': '28.868587', '9': '31.367679', '10': '34.143343', '11': '37.201', '12': '40.66', '13': '44.446668', '14': '48.563519', '15': '53.74848', '16': '59.081897', '17': '64.420047', '18': '69.724455', '19': '75.123137', '20': '80.584775', '21': '86.112028', '22': '91.703742', '23': '97.244628', '24': '102.812644', '25': '108.409563', '26': '113.201694', '27': '118.102906', '28': '122.979318', '29': '129.72733', '30': '136.29291', '31': '142.67085', '32': '149.029029', '33': '155.416987', '34': '161.825495', '35': '169.106313', '36': '176.518077', '37': '184.072741', '38': '191.709518', '39': '199.556908', '40': '207.382042', '41': '215.3989', '42': '224.165667', '43': '233.50216', '44': '243.350573', '45': '256.063067', '46': '268.543493', '47': '281.526075', '48': '295.013648', '49': '309.067188', '50': '323.601597', '51': '336.757542', '52': '350.530312', '53': '364.482705', '54': '378.619181', '55': '398.600417', '56': '416.398254', '57': '434.386996', '58': '452.951051', '59': '472.606217', '60': '492.88489', '61': '513.568543', '62': '539.103198', '63': '565.510563', '64': '592.538753', '65': '624.443427', '66': '651.470148', '67': '679.49683', '68': '707.79406', '69': '736.671422', '70': '765.640231', '71': '794.773403', '72': '824.677397', '73': '851.157781', '74': '877.74209', '75': '914.229123', '76': '946.746752', '77': '979.411386', '78': '1011.223022', '79': '1044.791746', '80': '1077.443668', '81': '1109.99754', '82': '1142.976615', '83': '1176.369483', '84': '1210.184393', '85': '1253.835659', '86': '1288.952801', '87': '1325.484092', '88': '1363.456928', '89': '1405.097377', '90': '1446.853458', '91': '1488.215547', '92': '1528.444567', '93': '1580.367911', '94': '1630.847528', '95': '1711.197785', '96': '1780.453941', '97': '1847.322809', '98': '1911.474309', '99': '1972.864342', '100': '2030.071808'}


def DEF_multiplier(character_level, enemy_level, DEF_ignored):

    enemy_DEF = (5 * enemy_level) + 500

    DEF_dmg_reduction = enemy_DEF/ (enemy_DEF + (5 * character_level) + 500)

    DEF_multiplier = (character_level + 100) / ((1 - DEF_dmg_reduction)(1 - DEF_ignored)(enemy_level + 100) + (character_level + 100))

    return DEF_multiplier


def RES_multiplier(enemy_RES, RES_reduction):
    RES = enemy_RES - RES_reduction
    if RES < 0:
        return 1 - (RES/2)
    elif RES < 0.75:
        return 1 - RES
    else:
        return 1/((4 * RES) + 1)


def reaction(reactants):
    if 'pyro' in reactants and ('cryo' in reactants or 'hydro' in reactants):
        return 'amplifying'
    elif 'electro' in reactants and 'dendro' in reactants:
        return 'catalyze'
    else:
        return 'transformative'


def transformative_DMG(reactants, EM, CRIT_DMG, character_level, RES_multiplier, reaction_bonus):
    reaction = ''
    if 'dendro' in reactants and 'pyro' in reactants:
        reaction = 'Burning'
    elif 'cryo' in reactants and 'electro' in reactants:
        reaction = 'Superconduct'
    elif 'anemo' in reactants and ('hydro' in reactants or 'cryo' in reactants or 'pyro' in reactants or 'electro' in reactants):
        reaction = 'Swirl'
    elif 'electro' in reactants and 'hydro' in reactants:
        reaction = 'Electro-charge'
    elif 'frozen' in reactants and 'physical' in reactants:
        reaction = 'Shattered'
    elif 'pyro' in reactants and 'electro' in reactants:
        reaction = 'Overloaded'
    elif 'dendro' in reactants and 'hydro' in reactants:
        reaction = 'Bloom'
    elif 'dendro core' in reactants and 'electro' in reactants:
        reaction = 'Hyperbloom'
    elif 'dendro core' in reactants and 'pyro' in reactants:
        reaction = 'Burgeon'

    reaction_table = {'Burning': 0, 'Superconduct': 1, 'Swirl': 2, 'Electro-Charge': 3, 'Shattered': 3, 'Overloaded': 4, 'Bloom': 4, 'Burgeon': 5, 'Hyperbloom': 5}

    # ! * 100% ?
    EM_bonus = 16 * (EM/(EM+2000))

    DMG = reaction_table[reaction] * (1 + EM_bonus + reaction_bonus) * RES_multiplier

    return DMG


def amplifying_multiplier(reactants, EM, reaction_bonus):
    reaction_multiplier = 1
    if reactants[0] == 'cryo' and reactants[1] == 'pyro':
        reaction_multiplier = 2
    elif reactants[0] == 'pyro' and reactants[1] == 'cryo':
        reaction_multiplier = 1.5
    if reactants[0] == 'pyro' and reactants[1] == 'hydro':
        reaction_multiplier = 2
    elif reactants[0] == 'hydro' and reactants[1] == 'pyro':
        reaction_multiplier = 1.5

    EM_bonus = 2.78 * (EM/(EM+1400))

    amplifying_multiplier = reaction_multiplier * (1 + EM_bonus + reaction_bonus)

    return amplifying_multiplier


def catalyze_bonus(reactants, EM, reaction_bonus, character_level):
    reaction_multiplier = 1
    if reactants[0] == 'electro' and reactants[1] == 'dendro':
        reaction_multiplier = 1.25
    elif reactants[0] == 'dendro' and reactants[1] == 'electro':
        reaction_multiplier = 1.5

    EM_bonus = (5*EM)/(EM+1200)

    DMG_bonus = reaction_multiplier * character_level_multiplier[character_level] * (1 + EM_bonus + reaction_bonus)

    return DMG_bonus


def general_DMG(ability, scalar, special_multiplier, flat_DMG_bonus, percent_DMG_bonus, DMG_reduction, DEF_multiplier, RES_multiplier, amplifying_multiplier):
    DMG = (((ability * scalar)* special_multiplier) + flat_DMG_bonus) * (1 + percent_DMG_bonus - DMG_reduction) * DEF_multiplier * RES_multiplier * amplifying_multiplier

    return DMG



